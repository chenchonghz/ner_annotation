<!DOCTYPE html>
{% extends "base.html" %}

{% load staticfiles %}


{%block script%}

<style>
    div.dataTables_filter {
        text-align: left;
    }
    .col-sm-6 {
        width: 20%;
    }
  .filterMatches { background-color: #FFFF00; }

  .content{
    min-height:75px !important;
  }


}

  </style>


<script>
      $(function () {
        /* jQueryKnob */

        //INITIALIZE SPARKLINE CHARTS
        $(".sparkline").each(function () {
          var $this = $(this);
          $this.sparkline('html', $this.data());
        });

        /* SPARKLINE DOCUMENTAION EXAMPLES http://omnipotent.net/jquery.sparkline/#s-about */
        drawDocSparklines();
        drawMouseSpeedDemo();

      });
      function drawDocSparklines() {

        // Bar + line composite charts
        $('#compositebar').sparkline('html', {type: 'bar', barColor: '#aaf'});
        $('#compositebar').sparkline([4, 1, 5, 7, 9, 9, 8, 7, 6, 6, 4, 7, 8, 4, 3, 2, 2, 5, 6, 7],
                {composite: true, fillColor: false, lineColor: 'red'});


        // Line charts taking their values from the tag
        $('.sparkline-1').sparkline();

        // Larger line charts for the docs
        $('.largeline').sparkline('html',
                {type: 'line', height: '2.5em', width: '4em'});

        // Customized line chart
        $('#linecustom').sparkline('html',
                {height: '1.5em', width: '8em', lineColor: '#f00', fillColor: '#ffa',
                  minSpotColor: false, maxSpotColor: false, spotColor: '#77f', spotRadius: 3});

        // Bar charts using inline values
        $('.sparkbar').sparkline('html', {type: 'bar'});



        // Tri-state charts using inline values
        $('.sparktristate').sparkline('html', {type: 'tristate'});
        $('.sparktristatecols').sparkline('html',
                {type: 'tristate', colorMap: {'-2': '#fa7', '2': '#44f'}});

        // Composite line charts, the second using values supplied via javascript
        $('#compositeline').sparkline('html', {fillColor: false, changeRangeMin: 0, chartRangeMax: 10});
        $('#compositeline').sparkline([4, 1, 5, 7, 9, 9, 8, 7, 6, 6, 4, 7, 8, 4, 3, 2, 2, 5, 6, 7],
                {composite: true, fillColor: false, lineColor: 'red', changeRangeMin: 0, chartRangeMax: 10});

        // Line charts with normal range marker
        $('#normalline').sparkline('html',
                {fillColor: false, normalRangeMin: -1, normalRangeMax: 8});
        $('#normalExample').sparkline('html',
                {fillColor: false, normalRangeMin: 80, normalRangeMax: 95, normalRangeColor: '#4f4'});

        // Discrete charts
        $('.discrete1').sparkline('html',
                {type: 'discrete', lineColor: 'blue', xwidth: 18});
        $('#discrete2').sparkline('html',
                {type: 'discrete', lineColor: 'blue', thresholdColor: 'red', thresholdValue: 4});

        // Bullet charts
        $('.sparkbullet').sparkline('html', {type: 'bullet'});

        // Pie charts
        $('.sparkpie').sparkline('html', {type: 'pie', height: '1.0em'});

        // Box plots
        $('.sparkboxplot').sparkline('html', {type: 'box'});
        $('.sparkboxplotraw').sparkline([1, 3, 5, 8, 10, 15, 18],
                {type: 'box', raw: true, showOutliers: true, target: 6});

        // Box plot with specific field order
        $('.boxfieldorder').sparkline('html', {
          type: 'box',
          tooltipFormatFieldlist: ['med', 'lq', 'uq'],
          tooltipFormatFieldlistKey: 'field'
        });

        // click event demo sparkline
        $('.clickdemo').sparkline();
        $('.clickdemo').bind('sparklineClick', function (ev) {
          var sparkline = ev.sparklines[0],
                  region = sparkline.getCurrentRegionFields();
          value = region.y;
          alert("Clicked on x=" + region.x + " y=" + region.y);
        });

        // mouseover event demo sparkline
        $('.mouseoverdemo').sparkline();
        $('.mouseoverdemo').bind('sparklineRegionChange', function (ev) {
          var sparkline = ev.sparklines[0],
                  region = sparkline.getCurrentRegionFields();
          value = region.y;
          $('.mouseoverregion').text("x=" + region.x + " y=" + region.y);
        }).bind('mouseleave', function () {
          $('.mouseoverregion').text('');
        });
      }

      /**
       ** Draw the little mouse speed animated graph
       ** This just attaches a handler to the mousemove event to see
       ** (roughly) how far the mouse has moved
       ** and then updates the display a couple of times a second via
       ** setTimeout()
       **/
      function drawMouseSpeedDemo() {
        var mrefreshinterval = 500; // update display every 500ms
        var lastmousex = -1;
        var lastmousey = -1;
        var lastmousetime;
        var mousetravel = 0;
        var mpoints = [];
        var mpoints_max = 30;
        $('html').mousemove(function (e) {
          var mousex = e.pageX;
          var mousey = e.pageY;
          if (lastmousex > -1) {
            mousetravel += Math.max(Math.abs(mousex - lastmousex), Math.abs(mousey - lastmousey));
          }
          lastmousex = mousex;
          lastmousey = mousey;
        });
        var mdraw = function () {
          var md = new Date();
          var timenow = md.getTime();
          if (lastmousetime && lastmousetime != timenow) {
            var pps = Math.round(mousetravel / (timenow - lastmousetime) * 1000);
            mpoints.push(pps);
            if (mpoints.length > mpoints_max)
              mpoints.splice(0, 1);
            mousetravel = 0;
            $('#mousespeed').sparkline(mpoints, {width: mpoints.length * 2, tooltipSuffix: ' pixels per second'});
          }
          lastmousetime = timenow;
          setTimeout(mdraw, mrefreshinterval);
        };
        // We could use setInterval instead, but I prefer to do it this way
        setTimeout(mdraw, mrefreshinterval);
      }
</script>


<script>


    $(document).ready(function() {

        //hide empty columns
        $('#recent tr th').each(function(i) {
         //select all tds in this column
         var tds = $(this).parents('table')
                  .find('tr td:nth-child(' + (i + 1) + ')');
            //check if all the cells in this column are empty
            if(tds.length == tds.filter(':empty').length) { 
                //hide header
                $(this).hide();
                //hide cells
                tds.hide();
            } 
        }); 


         var table = $('#recent').dataTable( {


            //highlight search text, CHECK
            "fnRowCallback": function( nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                var settings = this.fnSettings();
                var str = settings.oPreviousSearch.sSearch;
                var regex = new RegExp( str, 'i');
                $('td', nRow).each( function(i) {
                    this.innerHTML = aData[i].replace( regex, function(matched) { return "<span class='filterMatches'>"+matched+"</span>";});
                });
                return nRow;
            },
            "paging": true,
            "language": {
                "url": "//cdn.datatables.net/plug-ins/1.10.8/i18n/Chinese.json"
            },
            "scrollX": "100%",
            "scrollY": 195,
            "fixedHeader": true,
            "pageLength": 50,
            "bAutoWidth": true,
            "order": [[ 1, "desc" ]],
            //"oSearch": {"sSearch": "{{g}}"},
            "aoSearchCols": [null,{ "sSearch": "{{p}}"},null,{ "sSearch": "{{u}}"},null,null],

     
        } );//table

        //hide empty columns
        $('#mark tr th').each(function(i) {
         //select all tds in this column
         var tds = $(this).parents('table')
                  .find('tr td:nth-child(' + (i + 1) + ')');
            //check if all the cells in this column are empty
            if(tds.length == tds.filter(':empty').length) { 
                //hide header
                $(this).hide();
                //hide cells
                tds.hide();
            } 
        }); 


         var table = $('#mark').dataTable( {


            //highlight search text, CHECK
            "fnRowCallback": function( nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                var settings = this.fnSettings();
                var str = settings.oPreviousSearch.sSearch;
                var regex = new RegExp( str, 'i');
                $('td', nRow).each( function(i) {
                    this.innerHTML = aData[i].replace( regex, function(matched) { return "<span class='filterMatches'>"+matched+"</span>";});
                });
                return nRow;
            },
            "paging": true,
            "language": {
                "url": "//cdn.datatables.net/plug-ins/1.10.8/i18n/Chinese.json"
            },
            "scrollX": "100%",
            "scrollY": 100,
            "fixedHeader": true,
            "pageLength": 50,
            "bAutoWidth": true,
            "order": [[ 1, "desc" ]],
            //"oSearch": {"sSearch": "{{g}}"},
            "aoSearchCols": [null,{ "sSearch": "{{p}}"},null,{ "sSearch": "{{u}}"},null,null],

     
        } );//table
    } );
</script>


<script type="text/javascript">
      $(function () {
        "use strict";

        // AREA CHART
        var area = new Morris.Area({
          element: 'patient-number-chart',
          resize: true,
          data: [
            {y: '2014 Q1', item1: 3, item2: 8.5, item3: 5.65, item4: 4.13},
            {y: '2014 Q2', item1: 4, item2: 7.5, item3: 6.05, item4: 4.24},
            {y: '2014 Q3', item1: 5, item2: 8.0, item3: 7.325, item4: 4.75},
            {y: '2014 Q4', item1: 3, item2: 9.75, item3: 7.55, item4: 3.97},
            {y: '2015 Q1', item1: 3, item2: 7.0 ,item3: 5.675, item4: 4.13},
            {y: '2015 Q2', item1: 5, item2: 9.75, item3: 6.725, item4: 4.245},
            {y: '2015 Q3', item1: 7, item2: 6.0, item3: 5.35, item4: 4.012},
            {y: '2015 Q4', item1: 5, item2: 6.0, item3: 4.125, item4: 3.795}
          ],
          xkey: 'y',
          ykeys: ['item1', 'item2','item3', 'item4'],
          labels: ['我的数据','科室均值', '医院均值','行业均值'],
          lineColors: ['#a0d0e0', '#3c8dbc', "#f56954", "#00a65a"],
          hideHover: 'false'
        });

        // LINE CHART
        var line = new Morris.Line({
          element: 'line-chart',
          resize: true,
          data: [
            {y: '2015-01', item1: 0},
            {y: '2015-02', item1: 0},
            {y: '2015-03', item1: 0},
            {y: '2015-04', item1: 0},
            {y: '2015-05', item1: 0},
            {y: '2015-06', item1: 4},
            {y: '2015-07', item1: 22},
            {y: '2015-08', item1: 45},
          ],
          xkey: 'y',
          ykeys: ['item1'],
          labels: ['病人数目'],
          lineColors: ['#3c8dbc'],
          hideHover: 'auto'
        });

        //1-1-2 CHART
        var donut = new Morris.Donut({
          element: '1-1-2',
          resize: true,
          colors: ["#3c8dbc", "#f56954", "#00a65a"],
          data: [
            {label: "死亡", value: 12},
            {label: "随访中", value: 37},
            {label: "住院", value: 23}
          ],
          hideHover: 'auto'
        });

        //1-1-3 CHART
        var donut = new Morris.Donut({
          element: '1-1-3',
          resize: true,
          colors: ["#3c8dbc", "#f56954", "#00a65a"],
          data: [
            {label: "骨巨细胞瘤", value: 12},
            {label: "多发性骨髓瘤", value: 4},
            {label: "纤维结构不良", value: 11},
            {label: "嗜酸性肉芽肿", value: 8},
            {label: "神经鞘瘤", value: 23}
          ],
          hideHover: 'auto'
        });

        //1-1-4 CHART
        var donut = new Morris.Donut({
          element: '1-1-4',
          resize: true,
          colors: ["#3c8dbc", "#f56954", "#00a65a"],
          data: [
            {label: "下颈椎", value: 12},
            {label: "下胸椎", value: 17},
            {label: "上胸椎", value: 22},
            {label: "颈椎", value: 21}
          ],
          hideHover: 'auto'
        });

        //1-1-5 CHART
        var donut = new Morris.Donut({
          element: '1-1-5',
          resize: true,
          colors: ["#3c8dbc", "#f56954", "#00a65a"],
          data: [
            {label: "夜间痛", value: 12},
            {label: "根性疼痛", value: 31},
            {label: "肢体麻木", value: 23},
            {label: "体表包块", value: 44}
          ],
          hideHover: 'auto'
        });

        //BAR CHART
        var bar = new Morris.Bar({
          element: 'bar-chart',
          resize: true,
          data: [
            {y: '201501', a: 100, b: 90},
            {y: '201502', a: 75, b: 65},
            {y: '201503', a: 50, b: 40},
            {y: '201504', a: 75, b: 65},
            {y: '201505', a: 50, b: 40},
            {y: '201506', a: 75, b: 65},
            {y: '201507', a: 100, b: 90},
            {y: '201508', a: 100, b: 90},
            {y: '201509', a: 100, b: 90}
          ],
          barColors: ['#00a65a', '#f56954'],
          xkey: 'y',
          ykeys: ['a', 'b'],
          labels: ['伤口感染', '神经损害表现'],
          hideHover: 'auto'
        });
      });
</script>


{%endblock%}


{%block content%}

  <div class="content-wrapper">

    {% include "infoView/banner.html"%}


    <!-- Content Header (Page header) -->
    <ul class="breadcrumb">
      <li><a href="/">主页</a></li>
      <li class="active">控制台</li>
    </ul>
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        控制台
        <!--<small>电子病历 从未如此优雅</small>-->
      </h1>
      <ol class="breadcrumb">
        <li><a href=""><i class="fa fa-dashboard"></i> 主页</a></li>
        <li class="active">控制台</li>
      </ol>
    </section>

    <!-- Main content -->
    <section class="content">
      <!-- Small boxes (Stat box) -->
      <div class="row">
        <a href="/dashboard/#mypatient">
        <div class="col-lg-3 col-xs-6">
          <!-- small box -->
          <div class="small-box bg-green">
            <div class="inner">
              <h3 style='font-size:30px;color:white;'>病人 </h3>
              <p style='color:white;'>查看现有科室病人信息</p>
            </div>
            <div class="icon">
              <i class="ion ion-ios-person"></i>
            </div>
          </div>
        </div><!-- ./col -->
        </a>
        <a href="/dashboard/db/patient/add/">
        <div class="col-lg-3 col-xs-6">
          <!-- small box -->
          <div class="small-box bg-purple">
            <div class="inner">
              <h3 style='font-size:30px;color:white;'>添加 </h3>
              <p style='color:white;'>新建病人</p>
            </div>
            <div class="icon">
              <i class="ion ion-compose"></i>
            </div>
          </div>
        </div><!-- ./col -->
        </a>
        <a href="/dashboard/search/">
        <div class="col-lg-3 col-xs-6">
          <!-- small box -->
         <div class="small-box bg-yellow">
            <div class="inner">
              <h3 style='font-size:30px;color:white;'>搜索 </h3>
              <p style='color:white;'>自定义搜索 </p>
            </div>
            <div class="icon">
              <i class="ion ion-search"></i>
            </div>
          </div>
        </div><!-- ./col -->
        </a>
        <a href="#email">
        <div class="col-lg-3 col-xs-6">
          <!-- small box -->
          <div class="small-box bg-aqua">
            <div class="inner">
              <h3 style='font-size:30px;color:white;'>邮件</h3>
              <p style='color:white;'>邮件联系其他医师</p>
            </div>
            <div class="icon">
              <i class="ion ion-email"></i>
            </div>
          </div>
        </div><!-- ./col -->
        </a>
        
      </div><!-- /.row -->
    

      <!-- ALL Table row -->
      <div class="row">
        <section id='mypatient' class="content-header">
          <h1>
            全部病人
          </h1>
        </section>
        <!-- table col -->
        <section class="col-lg-12 connectedSortable">
          <div class="box">
            <div class="box-body">
              {% if objs.count %}
              <table class="table table-bordered table-striped " id="recent" class="display" cellspacing="0">
                  <thead>
                      <tr>
                          <th>操作</th>
                          <th>姓名</th>
                          <th>病历号</th>                
                          <th>性别</th>
                          <th>出生年月</th>
                          <!--<th>身份证号</th>-->
                          <th>地区</th>
                          <th>随访电话</th>
                          <th>去世日期</th>
                          <th>关系</th>
                          <th>电话</th>
                          <th>Email</th>
                          <th>微信</th>
                          <th>在随访中</th>

                      </tr>
                  </thead>

                  <tbody>
                          {% for obj in objs %}
                            <tr>
                              <td>
                                <small class="description-percentage"  style="position:relative;margin-right: 5px;"><a href='/dashboard/db/patient/edit/{{obj.DB_ID}}/{{obj.id}}/' ><i class="ion ion-edit" style='margin-left:5px;' alt='点击以编辑'></i></a></small>
                                <small class="description-percentage" onclick="return confirm('确定删除该病人的全部信息？');" style="position:relative;margin-right: 5px;"><a href='/dashboard/db/patient/delete/{{obj.DB_ID}}/{{obj.id}}/' ><i class="ion ion-trash-a" style='margin-left:5px;' alt='点击以删除'></i></a></small>
                              </td>
                              <td><a href="{{obj.get_absolute_url}}">{{obj.name}}</a></td>
                              <td><a href="{{obj.get_absolute_url}}">{{obj.get_standard_EMR_id}}</a></td>
                              <td>{{obj.sex}}</td>
                              <td>{{obj.get_standard_DOB_date}}</td>
                              <!--<td>{{obj.social_id}}</td>-->
                              <td>{{obj.location}}</td>
                              <td>{{obj.phone}}</td>
                              <td>{{obj.DOD}}</td>
                              <td>{{obj.get_relative_display}}</td>
                              <td>{{obj.relative_phone}}</td>
                              <td>{{obj.relative_email}}</td>
                              <td>{{obj.relative_wechat}}</td>
                              <td>{{obj.get_relative_in_contact_display}}</td>

                            </tr>

                          {% endfor %}
                  </tbody>
              </table>
              {% else %}
              <div class="panel-body" style="width: 95%;margin-left:auto;margin-right:auto;">
                  <div class="well well-sm" style="margin-bottom: 2px;">
                    <strong>数据库中找不到您有权限查看的病人！</strong>
                    <small class="description-percentage"><a href='/dashboard/db/patient/add/' ><i class="ion ion-compose" style='margin-left:20px;' alt='点击以添加'>&nbsp;点击以添加&nbsp;</i></a></small>
                  </div>

              </div>
              {% endif %}
            </div><!-- /.box-body -->
          </div><!-- /.box -->
        </section><!-- /.table col -->

      </div><!-- /.row (ALL table row) -->

      <!-- Marked Table row -->
      <div class="row" >
        <section class="content-header" id='marked'>
          <h1>
            标记的病人
          </h1>
        </section>
        <!-- table col -->
        <section class="col-lg-12 connectedSortable">
          <div class="box">
            <div class="box-body">
              {% if marked.count %}
              <table class="table table-bordered table-striped " id="mark" class="display" cellspacing="0">
                  <thead>
                      <tr>
                          <th>姓名</th>
                          <th>病历号</th>                
                          <th>性别</th>
                          <th>出生年月</th>
                          <!--<th>身份证号</th>-->
                          <th>地区</th>
                          <th>随访电话</th>
                          <th>去世日期</th>
                          <th>关系</th>
                          <th>电话</th>
                          <th>Email</th>
                          <th>微信</th>
                          <th>在随访中</th>

                      </tr>
                  </thead>

                  <tbody>
                          {% for obj in marked %}
                            <tr>
                              <td><a href="{{obj.get_absolute_url}}">{{obj.name}}</a></td>
                              <td><a href="{{obj.get_absolute_url}}">{{obj.get_standard_EMR_id}}</a></td>
                              <td>{{obj.sex}}</td>
                              <td>{{obj.get_standard_DOB_date}}</td>
                              <!--<td>{{obj.social_id}}</td>-->
                              <td>{{obj.location}}</td>
                              <td>{{obj.phone}}</td>
                              <td>{{obj.DOD}}</td>
                              <td>{{obj.get_relative_display}}</td>
                              <td>{{obj.relative_phone}}</td>
                              <td>{{obj.relative_email}}</td>
                              <td>{{obj.relative_wechat}}</td>
                              <td>{{obj.get_relative_in_contact_display}}</td>

                            </tr>

                          {% endfor %}
                  </tbody>
              </table>
              {% else %}
              <div class="panel-body" style="width: 95%;margin-left:auto;margin-right:auto;">
                  <div class="well well-sm" style="margin-bottom: 2px;">
                    <strong>无已标记病人！</strong>
                  </div>

              </div>
              {% endif %}
            </div><!-- /.box-body -->
          </div><!-- /.box -->
        </section><!-- /.table col -->

      </div><!-- /.row (table row) -->


      <!-- Charts row -->
      <div class="row" id='charts'>
        <section class="content-header">
          <h1>
            数据统计
            <small>beta</small>
          </h1>
        </section>
        <!-- left col -->
        <section class="col-lg-7 connectedSortable">
          
          <!-- AREA CHART -->
          <div class="box box-primary">
            <div class="box-header with-border">
              <h3 class="box-title">分类分析</h3>
              <div class="box-tools pull-right">
                <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-wrench">更改变量</i></button>
                <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                <button class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
              </div>
            </div>
            <div class="box-body chart-responsive">
              <div class="chart" id="patient-number-chart" style="height: 170px;"></div>
            </div><!-- /.box-body -->

              <div class="row">
                <div class="col-xs-3 text-center" style="border-right: 1px solid #f4f4f4">
                  <div class="box-body chart-responsive">
                    <div class="chart" id="1-1-2" style="height: 100px; position: relative;"></div>
                  </div><!-- /.box-body -->
                  <div class="knob-label">病人分类</div>
                </div><!-- ./col -->
                <div class="col-xs-3 text-center" style="border-right: 1px solid #f4f4f4">
                  <div class="box-body chart-responsive">
                    <div class="chart" id="1-1-3" style="height: 100px; position: relative;"></div>
                  </div><!-- /.box-body -->
                  <div class="knob-label">肿瘤分类</div>
                </div><!-- ./col -->
                <div class="col-xs-3 text-center">
                  <div class="box-body chart-responsive">
                    <div class="chart" id="1-1-4" style="height: 100px; position: relative;"></div>
                  </div><!-- /.box-body -->
                  <div class="knob-label">手术分类</div>
                </div><!-- ./col -->
                <div class="col-xs-3 text-center">
                  <div class="box-body chart-responsive">
                    <div class="chart" id="1-1-5" style="height: 100px; position: relative;"></div>
                  </div><!-- /.box-body -->
                  <div class="knob-label">症状分类</div>
                </div><!-- ./col -->
              </div><!-- /.row -->

          </div><!-- /.box -->
          
          <!-- LINE CHART -->
          <div class="box box-info">
            <div class="box-header with-border">
              <h3 class="box-title">趋势分析</h3>
              <div class="box-tools pull-right">
                <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-wrench">更改变量</i></button>
                <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                <button class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
              </div>
            </div>

            <div class="row">
              <div class="col-xs-6 text-center">
                <div class="box-body chart-responsive">
                  <div class="chart" id="line-chart" style="height: 120px;"></div>
                </div><!-- /.box-body -->
                <div class="knob-label">数据库条目增长趋势</div>
              </div>
              <div class="col-xs-6 text-center">
                <div class="box-body chart-responsive">
                  <div class="chart" id="bar-chart" style="height: 120px;"></div>
                </div><!-- /.box-body -->
                <div class="knob-label">与您相关的术后并发症统计</div>
              </div>
            </div>
          </div><!-- /.box -->      
          
          <div class="box box-primary">
                <div class="box-header">
                  <h3 class="box-title text-warning">肿瘤分析</h3>
                  <div class="box-tools pull-right">
                    <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-wrench">更改变量</i></button>
                    <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                    <button class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                  </div>
                </div><!-- /.box-header -->
                <div class="box-body text-center">
                  <div class="sparkline" data-type="bar" data-width="97%" data-height="100px" data-bar-Width="14" data-bar-Spacing="7" data-bar-Color="#f39c12">
                    6,4,8, 9, 10, 5, 13, 18, 21, 7, 9
                  </div>
                </div><!-- /.box-body -->
          </div><!-- /.box -->

        </section><!-- /.left col -->

        <!-- right col -->
        <section class="col-lg-5 connectedSortable">

          <div class="box box-warning">
            <div class="box-header">
              <h3 class="box-title">统计分析</h3>
              <div class="box-tools pull-right">
                <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-wrench">更改变量</i></button>
                <button class="btn btn-default btn-sm" data-widget="collapse"><i class="fa fa-minus"></i></button>
                <button class="btn btn-default btn-sm" data-widget="remove"><i class="fa fa-times"></i></button>
              </div>
            </div><!-- /.box-header -->
            <div id="myBody" class="box-body">

              <div class="row">
                <div class="col-xs-4 text-center" style="border-right: 1px solid #f4f4f4">
                  <div class="box-body chart-responsive">
                    <p>
                    <span class="sparkboxplot">34,35,45,32,52,34,33,43,24,43,23,22,44</span><br />
                    <span class="sparkboxplotraw">Loading..</span>
                  </p>
                  </div>
                  <div class="knob-label">病人年龄分布</div>
                </div><!-- ./col -->
                <div class="col-xs-4 text-center" style="border-right: 1px solid #f4f4f4">
                  <div class="box-body chart-responsive">
                  <p>
                    <span class="sparkboxplot">4,27,34,52,54,59,61,68,78,82,85,87,91,93,100</span><br />
                    <span class="sparkboxplotraw">Loading..</span>
                  </p>
                </div>
                  <div class="knob-label">病人体征（疼痛VAS）分布</div>
                </div><!-- ./col -->
                <div class="col-xs-4 text-center">
                  <div class="box-body chart-responsive">
                  <p>
                    <span class="sparkboxplot">12,34,2,53,43,33,23,46,74,12,1</span><br />
                    <span class="sparkboxplotraw">Loading..</span>
                  </p>
                </div>
                  <div class="knob-label">病人问卷评分分布</div>
                </div><!-- ./col -->
              </div><!-- /.row -->
              <hr>
               <div class="row">
                <div class="col-xs-4 text-center" style="border-right: 1px solid #f4f4f4">
                  <div class="box-body chart-responsive">
                    <p>
                    <span class="sparkboxplot">34,35,45,32,11,33,22,5</span><br />
                    <span class="sparkboxplotraw">Loading..</span>
                  </p>
                  </div>
                  <div class="knob-label">肿瘤直径分布</div>
                </div><!-- ./col -->
                <div class="col-xs-4 text-center" style="border-right: 1px solid #f4f4f4">
                  <div class="box-body chart-responsive">
                  <p>
                    <span class="sparkboxplot">1,7,34,52,54,500</span><br />
                    <span class="sparkboxplotraw">Loading..</span>
                  </p>
                </div>
                  <div class="knob-label">肿瘤扩散范围分布</div>
                </div><!-- ./col -->
                <div class="col-xs-4 text-center">
                  <div class="box-body chart-responsive">
                  <p>
                    <span class="sparkboxplot">11,21,13,41,5,4,7</span><br />
                    <span class="sparkboxplotraw">Loading..</span>
                  </p>
                </div>
                  <div class="knob-label">化疗效果分布</div>
                </div><!-- ./col -->
              </div><!-- /.row -->

            </div><!-- /.box-body -->
          </div><!-- /.box -->

          <div class="box box-info">
            <div class="box-header">
                  <h3 class="box-title text-blue">排名分析</h3>
                  <div class="box-tools pull-right">
                    <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-wrench">更改变量</i></button>
                    <button class="btn btn-default btn-sm" data-widget="collapse"><i class="fa fa-minus"></i></button>
                    <button class="btn btn-default btn-sm" data-widget="remove"><i class="fa fa-times"></i></button>
                  </div>
            </div><!-- /.box-header -->
            <div class="box-body text-center">
                  <div class="sparkline" data-type="line" data-spot-Radius="3" data-highlight-Spot-Color="#f39c12" data-highlight-Line-Color="#222" data-min-Spot-Color="#f56954" data-max-Spot-Color="#00a65a" data-spot-Color="#39CCCC" data-offset="90" data-width="100%" data-height="100px" data-line-Width="2" data-line-Color="#39CCCC" data-fill-Color="rgba(57, 204, 204, 0.08)">
                    6,4,7,8,4,3,2,2,5,6,7,4,1,5,7,9,9,8,7,6
                  </div>
                </div><!-- /.box-body -->
                <div class="knob-label">科室综合排名变化情况</div>
                <div class="box-footer">
                  <div class="row">
                    <div class="col-sm-3 col-xs-6">
                      <div class="description-block border-right">
                        <span class="description-percentage text-green"><i class="fa fa-caret-up"></i> 7.1%</span>
                        <h5 class="description-header">3/8(名)</h5>
                        <span class="description-text">科室排名</span>
                      </div><!-- /.description-block -->
                    </div><!-- /.col -->
                    <div class="col-sm-3 col-xs-6">
                      <div class="description-block border-right">
                        <span class="description-percentage text-red"><i class="fa fa-caret-down"></i> 18%</span>
                        <h5 class="description-header">34例</h5>
                        <span class="description-text">新增病人</span>
                      </div><!-- /.description-block -->
                    </div><!-- /.col -->
                    <div class="col-sm-3 col-xs-6">
                      <div class="description-block border-right">
                        <span class="description-percentage text-yellow"><i class="fa fa-exchange"></i> 0%</span>
                        <h5 class="description-header">12/45(名)</h5>
                        <span class="description-text">医院排名</span>
                      </div><!-- /.description-block -->
                    </div><!-- /.col -->
                    <div class="col-sm-3 col-xs-6">
                      <div class="description-block">
                        <span class="description-percentage text-red"><i class="fa fa-caret-down"></i> 3%</span>
                        <h5 class="description-header">3(位)</h5>
                        <span class="description-text">死亡率</span>
                      </div><!-- /.description-block -->
                    </div>
                  </div><!-- /.row -->
                </div><!-- /.box-footer -->
          </div><!-- /.box -->

        
          <!-- Map box -->
          <div class="box box-solid bg-light-blue-gradient">
            <div class="box-header">
              <!-- tools box -->
              <div class="pull-right box-tools">
                <button class="btn btn-primary btn-sm daterange pull-right" data-toggle="tooltip" title="Date range"><i class="fa fa-calendar"></i></button>
                <button class="btn btn-primary btn-sm pull-right" data-widget="collapse" data-toggle="tooltip" title="Collapse" style="margin-right: 5px;"><i class="fa fa-minus"></i></button>
              </div><!-- /. tools -->

              <i class="fa fa-map-marker"></i>
              <h3 class="box-title">
                病人分布
              </h3>
            </div>
            <div class="box-body">
              <div id="world-map" style="height: 250px; width: 100%;"></div>
            </div><!-- /.box-body-->
            <div class="box-footer no-border">
              <div class="row">
                <div class="col-xs-4 text-center" style="border-right: 1px solid #f4f4f4">
                  <div id="sparkline-1"></div>
                  <div class="knob-label">入院</div>
                </div><!-- ./col -->
                <div class="col-xs-4 text-center" style="border-right: 1px solid #f4f4f4">
                  <div id="sparkline-2"></div>
                  <div class="knob-label">出院</div>
                </div><!-- ./col -->
                <div class="col-xs-4 text-center">
                  <div id="sparkline-3"></div>
                  <div class="knob-label">死亡</div>
                </div><!-- ./col -->
              </div><!-- /.row -->
            </div>
          </div>
          <!-- /.box -->

          
        </section><!-- /.right col -->


      </div><!-- /.row (charts row) -->


      <!-- Tools row -->
      <div class="row">
        <section class="content-header">
          <h1>
            工具
            <small></small>
          </h1>
        </section>
        <!-- Left col -->
        <section class="col-lg-7 connectedSortable">
          <!-- quick email widget -->
          <div class="box box-info" id='email'>
            <div class="box-header">
              <i class="fa fa-envelope"></i>
              <h3 class="box-title">邮件联系</h3>
              <!-- tools box -->
              <div class="box-tools pull-right">
                    <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                    <button class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
              </div>
            </div>
            <div class="box-body">
              <form id='email_form' method='POST'>
               {% csrf_token %}
                <div class="form-group">
                  <input type="email" class="form-control" name="emailto" placeholder="发送至:" id='email-to'/>
                </div>
                <div class="form-group">
                  <input type="text" class="form-control" name="subject" placeholder="主题:" id='email-subject'/>
                </div>
                <div>
                  <textarea class="textarea" placeholder="内容" style="width: 100%; height: 125px; font-size: 14px; line-height: 18px; border: 1px solid #dddddd; padding: 10px;" name='content' id='email-content'></textarea>
                </div>
              </form>
            </div>
            <div class="box-footer clearfix">
              <button type="submit" form='email_form' class="pull-right btn btn-default" name='sendEmail' id="sendEmail">发送 <i class="fa fa-arrow-circle-right"></i></button>
            </div>
          </div>

        </section><!-- /.Left col -->
        <section class="col-lg-5 connectedSortable">
          <!-- NOTE -->
          <div class="box box-primary">
            <div class="box-header with-border">
             <i class="ion ion-document-text"></i> 
              <h3 class="box-title">备注</h3>
              <div class="box-tools pull-right">
                <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                <button class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
              </div>
            </div><!-- /.box-header -->
            <div class="box-body">
              <ul class="products-list product-list-in-box">
              {%if posts%}
              {% for p in posts|slice:":5" %}
                <li class="item">
                  <div class="product-info">
                    <a href="/virtual/get/{{p.related_exp.experiment_id}}/" class="product-title">{{p.subject}}</a>
                    <span class="product-description">
                      {{p.content}}
                      <p >Posted by {% autoescape off %}{{p.created_by.get_taged_investigator_name}}{% endautoescape %} on {{p.created_date}}</p>
                      {%if p.updated_by.NTID != None %}
                      <p>Last Modified by {% autoescape off %}{{p.updated_by.get_taged_investigator_name}}{% endautoescape %} on {{p.updated_date}}</p>
                      {%endif%}
                    </span>
                  </div>
                </li><!-- /.item -->
              {% endfor %}
              {%else%}
                <div class="panel panel-info" style="width:95%;margin-top:20px;margin-left:auto;margin-right:auto;">
                  <div class="panel-heading" >
                    <h4>暂无备注</h4>
                    <small class="description-percentage"><a href='#' ><i class="ion ion-compose" style='margin-left:20px;' alt='点击以编辑'>&nbsp;点击以添加（beta）&nbsp;</i></a></small>
                  </div>
                </div>
              {%endif%}
              </ul>
            </div><!-- /.box-body -->
          </div><!-- /.box -->    
        </section><!-- right col -->

      </div><!-- /.row (tools row) -->

    </section><!-- /.content -->
  </div><!-- /.content-wrapper -->


{%endblock%}

<!--
          <div class="row">
            <section id='mypatient' class="content-header">
              <h1>
                ###
              </h1>
            </section>
            <section class="col-lg-7 connectedSortable">
              <div class="box">
                <div class="box-body">
                </div>
              </div>
            </section>

          </div><

-->
